<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Caffeine Tracker</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
      <div class="login-container">
        <h1>Caffeine Tracker</h1>
        <p>Track and compete with others on caffeine consumption</p>
        <div
          id="g_id_onload"
          data-client_id="234386211848-jdc12q4obaau1nvpfu9lseq7j41hrrc9.apps.googleusercontent.com"
          data-callback="handleCredentialResponse"
          data-auto_prompt="false"
        ></div>
        <div
          class="g_id_signin"
          data-type="standard"
          data-size="large"
          data-theme="filled_blue"
          data-text="sign_in_with"
          data-shape="rectangular"
          data-logo_alignment="left"
        ></div>
      </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="app" style="display: none">
      <header class="app-header">
        <div class="header-content">
          <h1>Caffeine Tracker</h1>
          <div class="user-info">
            <img id="userAvatar" src="" alt="User Avatar" class="user-avatar" />
            <span id="userName"></span>
            <button onclick="signOut()" class="sign-out-btn">Sign Out</button>
          </div>
        </div>
      </header>

      <!-- Navigation Tabs -->
      <nav class="nav-tabs">
        <button class="tab-btn active" onclick="showTab('tracker')">
          Tracker
        </button>
        <button class="tab-btn" onclick="showTab('leaderboard')">
          Leaderboard
        </button>
      </nav>

      <!-- Tracker Tab -->
      <div id="trackerTab" class="tab-content active">
        <section class="stats">
          <div class="stat">
            <span id="todayTotal">0</span>
            <label>mg Today</label>
          </div>
          <div class="stat">
            <span id="todayCount">0</span>
            <label>Entries Today</label>
          </div>
          <div class="stat">
            <span id="allTimeTotal">0</span>
            <label>mg All Time</label>
          </div>
        </section>

        <main class="main">
          <div class="drinks-panel">
            <div class="panel-title">Drinks</div>
            <div id="drinksGrid" class="drinks-grid">
              <div class="drink-card add-drink" onclick="showAddDrinkModal()">
                <div class="plus">+</div>
                <div class="label">Add Drink</div>
              </div>
            </div>
          </div>

          <div class="entries-panel">
            <div class="panel-title">Recent Entries</div>
            <div id="entriesList" class="entries-list">
              <div class="loading">Loading...</div>
            </div>
          </div>
        </main>
      </div>

      <!-- Leaderboard Tab -->
      <div id="leaderboardTab" class="tab-content">
        <section class="leaderboard-section">
          <div class="leaderboard-header">
            <div class="leaderboard-title">
              <span class="trophy-icon">üèÜ</span>
              <h2>Leaderboard</h2>
            </div>
            <div class="period-selector">
              <button class="period-btn active" onclick="changePeriod('week')">
                Week
              </button>
              <button class="period-btn" onclick="changePeriod('month')">
                Month
              </button>
              <button class="period-btn" onclick="changePeriod('year')">
                Year
              </button>
              <button class="period-btn" onclick="changePeriod('all')">
                All Time
              </button>
            </div>
          </div>

          <!-- Caffeine Consumption Graph -->
          <div class="graph-card">
            <div class="graph-header">
              <h3>Caffeine Consumption Over Time</h3>
              <div class="graph-period" id="graphPeriod">Last 7 Days</div>
            </div>
            <canvas id="caffeineChart" width="400" height="200"></canvas>
          </div>

          <!-- Leaderboard Rankings -->
          <div id="leaderboardContent" class="leaderboard-content">
            <div class="loading">Loading leaderboard...</div>
          </div>
        </section>
      </div>

      <!-- Add Drink Modal -->
      <div id="addDrinkModal" class="modal">
        <div class="modal-box">
          <div class="modal-header">
            <h2>Add New Drink</h2>
            <button onclick="closeAddDrinkModal()">&times;</button>
          </div>
          <form id="addDrinkForm">
            <label>Name</label>
            <input autocomplete="off" type="text" id="drinkName" required />

            <label>Image URL (optional)</label>
            <input autocomplete="off" type="url" id="imageUrl" />

            <label>Size Variants</label>
            <div id="sizeVariants">
              <div class="size-variant">
                <input
                  type="text"
                  placeholder="Size name (e.g., 12oz)"
                  class="size-name"
                  required
                />
                <input
                  type="number"
                  placeholder="Caffeine (mg)"
                  class="size-caffeine"
                  required
                  min="1"
                />
                <button
                  type="button"
                  onclick="removeSizeVariant(this)"
                  class="remove-size"
                >
                  √ó
                </button>
              </div>
            </div>
            <button
              type="button"
              onclick="addSizeVariant()"
              class="add-size-btn"
            >
              + Add Size
            </button>

            <button type="submit">Add Drink</button>
          </form>
        </div>
      </div>

      <!-- Size Selection Modal -->
      <div id="sizeSelectionModal" class="modal">
        <div class="modal-box">
          <div class="modal-header">
            <h2 id="sizeModalTitle">Select Size</h2>
            <button onclick="closeSizeSelectionModal()">&times;</button>
          </div>
          <div id="sizeOptions" class="size-options">
            <!-- Size options will be populated here -->
          </div>
        </div>
      </div>

      <!-- Add Entry Modal -->
      <div id="addEntryModal" class="modal">
        <div class="modal-box">
          <div class="modal-header">
            <h2 id="entryModalTitle">Add Entry</h2>
            <button onclick="closeAddEntryModal()">&times;</button>
          </div>
          <form id="addEntryForm">
            <div id="selectedDrinkInfo" class="selected-info"></div>
            <label>Custom Description (optional)</label>
            <textarea
              id="customDescription"
              placeholder="Add any notes about this drink..."
            ></textarea>
            <button type="submit">Add Entry</button>
          </form>
        </div>
      </div>

      <div id="toast" class="toast"></div>

      <script src="script.js"></script>
    </div>
  </body>
</html>
